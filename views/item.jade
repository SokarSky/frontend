mixin OwlImages(path, imgName)
  div.carousel-container
    -if(size)
      a.fancybox(rel="group", href= path + '_lg.jpg')
        img(src= path + '_md.jpg', alt=imgName)
    -else
      a.fancybox(rel="group", href= path + '_md.jpg')
        img(src= path + '_sm.jpg', alt=imgName)

doctype html5
html(lang='en')
  head
    title= title
    
    // Yandex.Metrika counter
    
    script(type='text/javascript').
      (function (d, w, c) 
        { (w[c] = w[c] || []).push(function() 
          { 
            try 
              { 
                w.yaCounter37549200 = new Ya.Metrika({
                  id:37549200, 
                  clickmap:true, 
                  trackLinks:true, 
                  accurateTrackBounce:true, 
                  webvisor:true 
                }); 
              } 
              catch(e) 
              { }
          }); 
          var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { 
            n.parentNode.insertBefore(s, n); 
          }; 
          s.type = "text/javascript"; 
          s.async = true; 
          s.src = "https://mc.yandex.ru/metrika/watch.js"; 
          if (w.opera == "[object Opera]"){ 
            d.addEventListener("DOMContentLoaded", f, false); 
          }
          else { f(); } })(document, window, "yandex_metrika_callbacks");
    noscript
      div
        img(src='https://mc.yandex.ru/watch/37549200', style='position:absolute; left:-9999px;', alt='')
    // Yandex.Metrika counter
    
    // script(src="https://code.jquery.com/jquery-2.2.3.min.js", integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo=", crossorigin="anonymous")
    
    // script(type="text/javascript",src="/fancybox/lib/jquery.mousewheel-3.0.6.pack.js")
    // link(rel="stylesheet" href="/fancybox/source/jquery.fancybox.css" type="text/css" media="screen")
    // script(type="text/javascript" src="/fancybox/source/jquery.fancybox.pack.js")
    // link(rel="stylesheet" href="/fancybox/source/helpers/jquery.fancybox-buttons.css" type="text/css" media="screen")
    // script(type="text/javascript" src="/fancybox/source/helpers/jquery.fancybox-buttons.js")
    // script(type="text/javascript" src="/fancybox/source/helpers/jquery.fancybox-media.js")
    // link(rel="stylesheet", href="/owlcarousel/assets/owl.carousel.min.css")
    // link(rel="stylesheet", href="/owlcarousel/assets/owl.theme.default.min.css")
    // link(rel='stylesheet', href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css', integrity='sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7', crossorigin='anonymous')
    // link(rel='stylesheet', href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css', integrity='sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r', crossorigin='anonymous')
    // link(rel='stylesheet', href='https://fonts.googleapis.com/css?family=Raleway:400,700|Open+Sans&subset=latin,cyrillic')
    // link(rel='stylesheet', href='https://fonts.googleapis.com/css?family=Noto+Sans')
    // link(href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css", rel="stylesheet")
    // script(src="http://code.jquery.com/ui/1.9.2/jquery-ui.js")
    // script(src='/javascript/spritespin.js')
    // script(src='/javascript/megamenu.js')
    // link(rel='stylesheet', href='/stylesheets/ionicons.min.css')
    // link(rel='stylesheet', href='/stylesheets/footer.css', type='text/css')
    // link(rel='stylesheet', href='/stylesheets/menu.css', type='text/css')
    // link(rel='stylesheet', href='/stylesheets/banner.css', type='text/css')
    // link(rel='stylesheet', href='/stylesheets/item.css', type='text/css')
    // meta(name='viewport' content='width=device-width, initial-scale=1')
    // meta(charset='utf8')
    
    // script(type="text/javascript").
    //   $(document).ready(function() {
    //     $(".fancybox").fancybox({
    //       prevEffect: 'none',
    //       nextEffect: 'none',
    //     });
    //     $(".fancybox-iframe").fancybox({
    //       autoSize: false,
    //       type: "iframe",
    //       height: 600,
    //       width: 1000
    //     });
    //     $(".btnForm").fancybox({
    //       autoSize: true
    //     });
    //     $('.images').owlCarousel({
    //       loop: false,
    //       items:3,
    //       dots: true,
    //       nav: false
    //     });
    //   });
    script(src="https://code.jquery.com/jquery-2.2.3.min.js", integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo=", crossorigin="anonymous")
    script(src="/owlcarousel/owl.carousel.min.js")
    script(src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js', integrity='sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS', crossorigin='anonymous')
    script(type="text/javascript",src="/fancybox/lib/jquery.mousewheel-3.0.6.pack.js")
    link(rel="stylesheet" href="/fancybox/source/jquery.fancybox.css" type="text/css" media="screen")
    script(type="text/javascript" src="/fancybox/source/jquery.fancybox.pack.js")
    link(rel="stylesheet" href="/fancybox/source/helpers/jquery.fancybox-buttons.css" type="text/css" media="screen")
    script(type="text/javascript" src="/fancybox/source/helpers/jquery.fancybox-buttons.js")
    script(type="text/javascript" src="/fancybox/source/helpers/jquery.fancybox-media.js")
    link(rel="stylesheet", href="/owlcarousel/assets/owl.carousel.min.css")
    link(rel="stylesheet", href="/owlcarousel/assets/owl.theme.default.min.css")
    link(rel='stylesheet', href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css', integrity='sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7', crossorigin='anonymous')
    link(rel='stylesheet', href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css', integrity='sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r', crossorigin='anonymous')
    link(rel='stylesheet', href='https://fonts.googleapis.com/css?family=Raleway:400,700|Open+Sans&subset=latin,cyrillic')
    link(rel='stylesheet', href='https://fonts.googleapis.com/css?family=Noto+Sans')
    link(href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css", rel="stylesheet")
    script(src="http://code.jquery.com/ui/1.9.2/jquery-ui.js")
    script(src='/javascript/spritespin.js')
    script(src='/javascript/megamenu.js')
    link(rel='stylesheet', href='/stylesheets/ionicons.min.css')
    link(rel='stylesheet', href='/stylesheets/footer.css', type='text/css')
    link(rel='stylesheet', href='/stylesheets/menu.css', type='text/css')
    link(rel='stylesheet', href='/menu.css', type='text/css')
    link(rel='stylesheet', href='/stylesheets/banner.css', type='text/css')
    link(rel='stylesheet', href='/stylesheets/item.css', type='text/css')
    link(rel='stylesheet', href='/item.css', type='text/css')
    meta(name='viewport' content='width=device-width, initial-scale=1')
    meta(charset='utf8')
    
    script(type="text/javascript").
      $(document).ready(function() {
        $(".fancybox").fancybox({
          prevEffect: 'none',
          nextEffect: 'none',
        });
        $(".fancybox-iframe").fancybox({
          autoSize: false,
          type: "iframe",
          height: 600,
          width: 1000
        });
        $(".btnForm").fancybox({
          autoSize: false,
          height: $(window).height()/2,
          width: $(window).width()/2
        });
        $('.images').owlCarousel({
          loop: false,
          items:3,
          dots: true,
          nav: false
        });
      });
    
  body
    header
      include ./menu.jade 
      include ./banner.jade
    
    main
      .container-fluid
        .row
          .hidden-xs.hidden-sm.col-md-3.col-md-offset-1.left-sidebar
            include ./category-tree.jade
          .col-sm-10.col-sm-offset-1.col-md-7.col-md-offset-0.center
            .container-fluid
              .row
                .col-sm-5.img
                  .row
                    -if(size)
                      a.col-sm-12.fancybox(href='#{parcedJson.exhibit.img.relativepath}' + '_lg.jpg', rel="group")
                        img.img-responsive(src='#{parcedJson.exhibit.img.relativepath}' + '_md.jpg' alt='parcedJson.exhibit.title')
                    -else
                      a.col-sm-12.fancybox(href='#{parcedJson.exhibit.img.relativepath}' + '_md.jpg', rel="group")
                        img.img-responsive(src='#{parcedJson.exhibit.img.relativepath}' + '_sm.jpg' alt='parcedJson.exhibit.title')
                  .row
                    .container-fluid
                      .images.owl-carousel.owl-theme
                        each image in parcedJson.exhibit.images
                          +OwlImages(image.relativepath, parcedJson.exhibit.title)
                .col-sm-7    
                  .row
                    h3.title= parcedJson.exhibit.title
                    .date
                      span.glyphicon.glyphicon-time
                        |  #{parcedJson.exhibit.dateStarted}-#{parcedJson.exhibit.dateFinish}
                    .tags
                      each tag in parcedJson.exhibit.tags
                        a(href='/search/tags/#{tag}')
                          span.glyphicon.glyphicon-tag
                            | #{tag}
                    -if(parcedJson.exhibit.model3d != undefined)
                      a.btn.btn-md.col-sm-5.col-lg-4.btn-primary.fancybox-iframe(href='#{domain}'+'#{pathTo3D}'+'#{parcedJson.exhibit.model3d.json}')
                        | Покрутити в 3D
                    -else if(parcedJson.exhibit.altModel3d != undefined)
                      a.btn.btn-md.col-sm-5.btn-primary.btnForm(href="#divForm")
                        | Покрутити 360 view
                      
                      // Alexis slider
                      .container-fluid.slider#divForm(style='display: none;')
                         #container
                            .spritespin
                            #slider
                                script(type='text/javascript').
                                 var viewClientWidth;
                                 var viewClientHeight;
                                    if($(window).height()> $(window).width()){
                                         viewClientWidth = $(window).width();
                                         viewClientHeight = $(window).width()/1.5;
                                    }else{
                                         viewClientWidth = $(window).height()*1.5;
                                         viewClientHeight = $(window).height();
                                    }
                                    var framess = #{parcedJson.exhibit.altModel3d.count};
                                    var spin = $('.spritespin');
                                    var slide = $('#slider');
                                    var path = '#{domain}'+ '#{parcedJson.exhibit.altModel3d.relativepath}';
                                   
                                    spin.spritespin({
                                        source: path,
                                        width: viewClientWidth/2,
                                        sense: -1,
                                        height: viewClientHeight/2,
                                        frames: framess,
                                        framesX: 4,
                                        renderer: 'image',
                                        mods: ['move', '360'],
                                        behavior: null,
                                        module: null,
                                        onLoad: function(){
                                            slide.slider({
                                                min: 0,
                                                max: parseInt(framess)*1.5,
                                                slide: function(e, ui){
                                                    var api = spin.spritespin('api');
                                                    api.stopAnimation();
                                                    api.updateFrame(ui.value);
                                                }
                                            })
                                        },
                                        onFrame: function(e, data){
                                            slide.slider('value', data.frame);
                                        }
                                    });               
                                     
              -if(parcedJson.exhibit.characteristics[0] != undefined)
                .container-fluid
                  .row
                    table.table.table-striped
                      thead
                        tr
                          th Характеристики
                          th
                      tbody
                        each item in parcedJson.exhibit.characteristics
                          tr
                            td= item.name
                            td= item.value
              .row
                .fullInfo
                  span!= parcedJson.exhibit.body
    include ./footer.jade